Hooks:Add("LocalizationManagerPostInit", "LocalizationManagerPostInit_ICT", function( loc )
	local localization = ICT._path .. "loc/"
	local GetFiles = _G.file.GetFiles
	local Idstring = _G.Idstring
	local activelanguagekey = SystemInfo:language():key()
	for __, filename in ipairs(GetFiles(localization)) do
		if Idstring(filename:match("^(.*).json$") or ""):key() == activelanguagekey then
			loc:load_localization_file(localization .. filename)
		    break
		end
	end
	loc:load_localization_file(localization .. "english.json", false)
end)

Hooks:Add("MenuManagerBuildCustomMenus", "MenuManagerBuildCustomMenus_ICT", function(menu_manager, nodes)
    MenuCallbackHandler.OpenICTModOptions = function(self, item)
        ICT.Menu = ICT.Menu or ICTMenu:new()
		ICT.Menu:Open()

        Hooks:PostHook(MenuManager, "update", "update_menu_ICT", function(self, t, dt)
            if ICT.Menu and ICT.Menu.update and ICT.Menu._enabled then
                ICT.Menu:update(t, dt)
            end
        end)
	end

	local node = nodes["blt_options"]

	local item_params = {
		name = "ICT_OpenMenu",
		text_id = "ICT_title",
		help_id = "ICT_desc",
		callback = "OpenICTModOptions",
		localize = true,
	}
	local item = node:create_item({type = "CoreMenuItem.Item"}, item_params)
    node:add_item(item)
end)